!function(){"use strict";var e;function t(t,n,i=e.Debug){const r=`(Glean.${t})`;Array.isArray(n)?console[i](r,...n):console[i](r,n)}!function(e){e.Debug="debug",e.Info="info",e.Warn="warn",e.Error="error",e.Trace="trace"}(e||(e={}));var n;!function(e){e[e.RecoverableFailure=0]="RecoverableFailure",e[e.UnrecoverableFailure=1]="UnrecoverableFailure",e[e.Success=2]="Success"}(n||(n={}));class i{constructor(e,t){this.result=e,this.status=t}}var r=class{};const s="platform.browser.FetchUploader";var a=new class extends r{constructor(){super(...arguments),this.timeoutMs=1e4}async post(n,r,a=!0){const o=new AbortController,c=setTimeout((()=>o.abort()),this.timeoutMs),l=r.asCompressedPayload();let d;try{d=await fetch(n.toString(),{headers:l.headers,method:"POST",body:l.payload,keepalive:a,credentials:"omit",signal:o.signal,redirect:"error"})}catch(u){if(u instanceof DOMException)t(s,["Timeout while attempting to upload ping.\n",u],e.Error);else if(u instanceof TypeError){if(a)return this.post(n,l,!1);t(s,["Network error while attempting to upload ping.\n",u],e.Error)}else t(s,["Unknown error while attempting to upload ping.\n",u],e.Error);return clearTimeout(c),new i(0)}return clearTimeout(c),new i(2,d.status)}supportsCustomHeaders(){return!0}};var o=new class extends r{constructor(){super(...arguments),this.timeoutMs=1e4}async post(n,r,s=!0){return navigator.sendBeacon(n,r.payload)?new i(2,200):(s&&t("platform.browser.SendBeaconUploader","The `sendBeacon` call was not serviced by the browser. Deleting data.",e.Error),new i(1))}supportsCustomHeaders(){return!1}};const c="core.Context";class l{constructor(){this.initialized=!1,this.testing=!1,this.supportedMetrics={},this.startTime=new Date}static get instance(){return l._instance||(l._instance=new l),l._instance}static testUninitialize(){l._instance=undefined}static get uploadEnabled(){return"undefined"==typeof l.instance.uploadEnabled&&t(c,["Attempted to access Context.uploadEnabled before it was set. This may cause unexpected behaviour."],e.Trace),l.instance.uploadEnabled}static set uploadEnabled(e){l.instance.uploadEnabled=e}static get metricsDatabase(){return"undefined"==typeof l.instance.metricsDatabase&&t(c,["Attempted to access Context.metricsDatabase before it was set. This may cause unexpected behaviour."],e.Trace),l.instance.metricsDatabase}static set metricsDatabase(e){l.instance.metricsDatabase=e}static get eventsDatabase(){return"undefined"==typeof l.instance.eventsDatabase&&t(c,["Attempted to access Context.eventsDatabase before it was set. This may cause unexpected behaviour."],e.Trace),l.instance.eventsDatabase}static set eventsDatabase(e){l.instance.eventsDatabase=e}static get pingsDatabase(){return"undefined"==typeof l.instance.pingsDatabase&&t(c,["Attempted to access Context.pingsDatabase before it was set. This may cause unexpected behaviour."],e.Trace),l.instance.pingsDatabase}static set pingsDatabase(e){l.instance.pingsDatabase=e}static get errorManager(){return"undefined"==typeof l.instance.errorManager&&t(c,["Attempted to access Context.errorManager before it was set. This may cause unexpected behaviour."],e.Trace),l.instance.errorManager}static set errorManager(e){l.instance.errorManager=e}static get applicationId(){return"undefined"==typeof l.instance.applicationId&&t(c,["Attempted to access Context.applicationId before it was set. This may cause unexpected behaviour."],e.Trace),l.instance.applicationId}static set applicationId(e){l.instance.applicationId=e}static get initialized(){return l.instance.initialized}static set initialized(e){l.instance.initialized=e}static get config(){return"undefined"==typeof l.instance.config&&t(c,["Attempted to access Context.config before it was set. This may cause unexpected behaviour."],e.Trace),l.instance.config}static set config(e){l.instance.config=e}static get startTime(){return l.instance.startTime}static get testing(){return l.instance.testing}static set testing(e){l.instance.testing=e}static get corePings(){return l.instance.corePings}static set corePings(e){l.instance.corePings=e}static get coreMetrics(){return l.instance.coreMetrics}static set coreMetrics(e){l.instance.coreMetrics=e}static set platform(e){l.instance.platform=e}static get platform(){return"undefined"==typeof l.instance.platform&&t(c,["Attempted to access Context.platform before it was set. This may cause unexpected behaviour."],e.Trace),l.instance.platform}static isPlatformSet(){return!!l.instance.platform}static getSupportedMetric(e){return l.instance.supportedMetrics[e]}static addSupportedMetric(e,t){e in l.instance.supportedMetrics||(l.instance.supportedMetrics[e]=t)}}const d="platform.browser.SendBeaconFallbackUploader";var u=new class extends r{constructor(){super(...arguments),this.fetchUploader=a,this.sendBeaconUploader=o}async post(n,i){var r,s;if(!(null===(r=l.config)||void 0===r?void 0:r.sourceTags)&&!(null===(s=l.config)||void 0===s?void 0:s.debugViewTag)&&navigator&&navigator.sendBeacon){const r=await this.sendBeaconUploader.post(n,i,!1);if(2==r.result)return r;t(d,"The `sendBeacon` call was not serviced by the browser. Falling back to the `fetch` uploader.",e.Warn)}else t(d,"`sendBeacon` is not available. Falling back to the `fetch` uploader.",e.Warn);return this.fetchUploader.post(n,i)}supportsCustomHeaders(){return!1}};var g={os(){let e;return e=navigator&&navigator.userAgent?navigator.userAgent:"Unknown",e.includes("Windows")?"Windows":/tvOS/i.test(e)?"TvOS":/Watch( OS)?/i.test(e)?"WatchOS":/iPhone|iPad|iOS/i.test(e)?"iOS":/Mac OS X|macOS/i.test(e)?"Darwin":/Android/i.test(e)?"Android":/CrOS/i.test(e)?"ChromeOS":/WebOS/i.test(e)?"WebOS":/Linux/i.test(e)?"Linux":/OpenBSD/i.test(e)?"OpenBSD":/FreeBSD/i.test(e)?"FreeBSD":/NetBSD/i.test(e)?"NetBSD":/SunOS/i.test(e)?"SunOS":/AIX/i.test(e)?"IBM_AIX":"Unknown"},osVersion(){return"Unknown"},arch(){return"Unknown"},locale(){return navigator&&navigator.language?navigator.language:"und"}};var f={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let p;const h=new Uint8Array(16);function m(){if(!p&&(p="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!p))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return p(h)}const b=[];for(let e=0;e<256;++e)b.push((e+256).toString(16).slice(1));function v(e,t=0){return(b[e[t+0]]+b[e[t+1]]+b[e[t+2]]+b[e[t+3]]+"-"+b[e[t+4]]+b[e[t+5]]+"-"+b[e[t+6]]+b[e[t+7]]+"-"+b[e[t+8]]+b[e[t+9]]+"-"+b[e[t+10]]+b[e[t+11]]+b[e[t+12]]+b[e[t+13]]+b[e[t+14]]+b[e[t+15]]).toLowerCase()}var y,w,S=function(e,t,n){if(f.randomUUID&&!t&&!e)return f.randomUUID();const i=(e=e||{}).random||(e.rng||m)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=i[e];return t}return v(i)};!function(e){e.InvalidValue="invalid_value",e.InvalidLabel="invalid_label",e.InvalidState="invalid_state",e.InvalidOverflow="invalid_overflow",e.InvalidType="invalid_type"}(y||(y={})),function(e){e[e.Success=0]="Success",e[e.Error=1]="Error"}(w||(w={}));class E extends Error{constructor(e,t=y.InvalidType){super(e),this.type=t,this.name="MetricValidationError"}recordError(e){l.errorManager.record(e,this.type,this.message)}}class I{constructor(e){this.inner=this.validateOrThrow(e)}get(){return this.inner}set(e){this.inner=e}validateOrThrow(e){const t=this.validate(e);if(t.type===w.Error)throw new E(t.errorMessage,t.errorType);return e}}function D(e){if(P(e)||M(e)||$(e))return!0;if(T(e)){if(0===Object.keys(e).length)return!0;for(const t in e)return D(e[t])}return!!Array.isArray(e)&&e.every((e=>D(e)))}function T(e){return"object"==typeof e&&null!==e&&e.constructor===Object}function x(e){return void 0===e}function P(e){return"string"==typeof e}function M(e){return"boolean"==typeof e}function $(e){return"number"==typeof e&&!isNaN(e)}function _(e){return $(e)&&Number.isInteger(e)}function U(e){return/^[a-z0-9-]{1,20}$/i.test(e)}function k(){return"undefined"!=typeof crypto?S():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function C(){const e="undefined"==typeof performance?Date.now():performance.now();return Math.round(e)}function A(e,t,n){if(!P(t))throw new E(`Expected string, got ${JSON.stringify(t)}`);const i=new TextEncoder,r=new TextDecoder("utf-8"),s=i.encode(t).slice(0,n),a=r.decode(s);return a!==t&&l.errorManager.record(e,y.InvalidOverflow,`Value length ${new Blob([t]).size} exceeds maximum of ${t.length} bytes.`),a}function O(n,i="core.utils"){return!!l.testing||(t(i,[`Attempted to access test only method \`${n||"unknown"}\`,`,"but Glean is not in testing mode. Ignoring. Make sure to put Glean in testing mode","before accessing such methods, by calling `testResetGlean`."],e.Error),!1)}function z(){return"undefined"==typeof window}const L="platform.web.Storage";var G=class{constructor(e){this.rootKey=e,this.logTag=`${L}.${e}`}get(n=[]){if(z())return;let i;try{const e=localStorage.getItem(this.rootKey)||"{}",t=JSON.parse(e);i=n.length>0?function(e,t){if(0===t.length)throw Error("The index must contain at least one property to get.");let n=e;for(const e of t){if(!T(n)||!(e in n))return;{const t=n[e];D(t)&&(n=t)}}return n}(t,n):0===Object.keys(t).length?undefined:t}catch(we){t(L,["Unable to fetch value from local storage.",we],e.Error)}return this.shouldUpdateSession(n)&&l.coreMetrics.updateSessionInfo(),i}update(n,i){if(!z()){try{const e=localStorage.getItem(this.rootKey)||"{}",t=function(e,t,n){if(0===t.length)throw Error("The index must contain at least one property to update.");const i={...e};let r=i;for(const e of t.slice(0,t.length-1))T(r[e])||(r[e]={}),r=r[e];const s=t[t.length-1],a=n(r[s]);return r[s]=a,i}(JSON.parse(e),n,i);localStorage.setItem(this.rootKey,JSON.stringify(t))}catch(we){t(L,["Unable to update value from local storage.",we],e.Error)}this.shouldUpdateSession(n)&&l.coreMetrics.updateSessionInfo()}}"delete"(n){if(!z()){try{const r=localStorage.getItem(this.rootKey)||"{}",s=JSON.parse(r);if(0===n.length)localStorage.removeItem(this.rootKey);else try{const e=function(e,t){if(0===t.length)return{};const n={...e};let i=n;for(const e of t.slice(0,t.length-1)){const n=i[e];if(!T(n))throw Error(`Attempted to delete an entry from an inexistent index: ${JSON.stringify(t)}.`);i=n}return delete i[t[t.length-1]],n}(s,n);localStorage.setItem(this.rootKey,JSON.stringify(e))}catch(i){t(this.logTag,[`Error attempting to delete key ${n.toString()} from storage. Ignoring.`,i],e.Warn)}}catch(we){t(L,["Unable to delete value from storage.",we],e.Error)}this.shouldUpdateSession(n)&&l.coreMetrics.updateSessionInfo()}}shouldUpdateSession(e){return!e.includes("session_id")&&!e.includes("session_count")}};var N={Storage:G,uploader:u,info:g,timer:{setTimeout:setTimeout,clearTimeout:clearTimeout},name:"web"};const V="5.0.3",R="glean_ping_info",B="glean_client_info",F="c0ffeec0-ffee-c0ff-eec0-ffeec0ffeec0",W="deletion-request",j="events",J="#glean_reference_time",q="#glean_execution_counter",H=[q,J],K="core.Config";class X{constructor(e){var t,n;if(this.channel=null==e?void 0:e.channel,this.appBuild=null==e?void 0:e.appBuild,this.appDisplayVersion=null==e?void 0:e.appDisplayVersion,this.buildDate=null==e?void 0:e.buildDate,this.maxEvents=(null==e?void 0:e.maxEvents)||1,this.enableAutoPageLoadEvents=null==e?void 0:e.enableAutoPageLoadEvents,this.enableAutoElementClickEvents=null==e?void 0:e.enableAutoElementClickEvents,this.experimentationId=null==e?void 0:e.experimentationId,this.sessionLengthInMinutesOverride=null==e?void 0:e.sessionLengthInMinutesOverride,this.debug={},(null==e?void 0:e.serverEndpoint)&&(n=e.serverEndpoint,!/^(http|https):\/\/[a-zA-Z0-9._-]+(:\d+){0,1}(\/{0,1})$/i.test(n)))throw new Error(`Unable to initialize Glean, serverEndpoint ${e.serverEndpoint} is an invalid URL.`);if(!l.testing&&(null===(t=null==e?void 0:e.serverEndpoint)||void 0===t?void 0:t.startsWith("http:")))throw new Error(`Unable to initialize Glean, serverEndpoint ${e.serverEndpoint} must use the HTTPS protocol.`);this.serverEndpoint=e&&e.serverEndpoint?e.serverEndpoint:"https://incoming.telemetry.mozilla.org",this.httpClient=null==e?void 0:e.httpClient}get logPings(){return this.debug.logPings||!1}set logPings(e){this.debug.logPings=e}get debugViewTag(){return this.debug.debugViewTag}set debugViewTag(n){U(n||"")?this.debug.debugViewTag=n:t(K,[`"${n||""}" is not a valid \`debugViewTag\` value.`,"Please make sure the value passed satisfies the regex `^[a-zA-Z0-9-]{1,20}$`."],e.Error)}get sourceTags(){return this.debug.sourceTags}set sourceTags(n){if(!n||n.length<1||n.length>5)t(K,"A list of tags cannot contain more than 5 elements or less than one.",e.Error);else{for(const i of n){if(i.startsWith("glean"))return void t(K,"Tags starting with `glean` are reserved and must not be used.",e.Error);if(!U(i))return}this.debug.sourceTags=n}}}var Q=Uint8Array,Y=Uint16Array,Z=Int32Array,ee=new Q([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),te=new Q([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ne=new Q([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ie=function(e,t){for(var n=new Y(31),i=0;i<31;++i)n[i]=t+=1<<e[i-1];var r=new Z(n[30]);for(i=1;i<30;++i)for(var s=n[i];s<n[i+1];++s)r[s]=s-n[i]<<5|i;return{b:n,r:r}},re=ie(ee,2),se=re.b,ae=re.r;se[28]=258,ae[258]=28;for(var oe=ie(te,0),ce=(oe.b,oe.r),le=new Y(32768),de=0;de<32768;++de){var ue=(43690&de)>>1|(21845&de)<<1;ue=(61680&(ue=(52428&ue)>>2|(13107&ue)<<2))>>4|(3855&ue)<<4,le[de]=((65280&ue)>>8|(255&ue)<<8)>>1}var ge=function(e,t,n){for(var i=e.length,r=0,s=new Y(t);r<i;++r)e[r]&&++s[e[r]-1];var a,o=new Y(t);for(r=1;r<t;++r)o[r]=o[r-1]+s[r-1]<<1;if(n){a=new Y(1<<t);var c=15-t;for(r=0;r<i;++r)if(e[r])for(var l=r<<4|e[r],d=t-e[r],u=o[e[r]-1]++<<d,g=u|(1<<d)-1;u<=g;++u)a[le[u]>>c]=l}else for(a=new Y(i),r=0;r<i;++r)e[r]&&(a[r]=le[o[e[r]-1]++]>>15-e[r]);return a},fe=new Q(288);for(de=0;de<144;++de)fe[de]=8;for(de=144;de<256;++de)fe[de]=9;for(de=256;de<280;++de)fe[de]=7;for(de=280;de<288;++de)fe[de]=8;var pe=new Q(32);for(de=0;de<32;++de)pe[de]=5;var he=ge(fe,9,0),me=ge(pe,5,0),be=function(e){return(e+7)/8|0},ve=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var i=new Q(n-t);return i.set(e.subarray(t,n)),i},ye=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],we=function(e,t,n){var i=new Error(t||ye[e]);if(i.code=e,Error.captureStackTrace&&Error.captureStackTrace(i,we),!n)throw i;return i},Se=function(e,t,n){n<<=7&t;var i=t/8|0;e[i]|=n,e[i+1]|=n>>8},Ee=function(e,t,n){n<<=7&t;var i=t/8|0;e[i]|=n,e[i+1]|=n>>8,e[i+2]|=n>>16},Ie=function(e,t){for(var n=[],i=0;i<e.length;++i)e[i]&&n.push({s:i,f:e[i]});var r=n.length,s=n.slice();if(!r)return{t:_e,l:0};if(1==r){var a=new Q(n[0].s+1);return a[n[0].s]=1,{t:a,l:1}}n.sort((function(e,t){return e.f-t.f})),n.push({s:-1,f:25001});var o=n[0],c=n[1],l=0,d=1,u=2;for(n[0]={s:-1,f:o.f+c.f,l:o,r:c};d!=r-1;)o=n[n[l].f<n[u].f?l++:u++],c=n[l!=d&&n[l].f<n[u].f?l++:u++],n[d++]={s:-1,f:o.f+c.f,l:o,r:c};var g=s[0].s;for(i=1;i<r;++i)s[i].s>g&&(g=s[i].s);var f=new Y(g+1),p=De(n[d-1],f,0);if(p>t){i=0;var h=0,m=p-t,b=1<<m;for(s.sort((function(e,t){return f[t.s]-f[e.s]||e.f-t.f}));i<r;++i){var v=s[i].s;if(!(f[v]>t))break;h+=b-(1<<p-f[v]),f[v]=t}for(h>>=m;h>0;){var y=s[i].s;f[y]<t?h-=1<<t-f[y]++-1:++i}for(;i>=0&&h;--i){var w=s[i].s;f[w]==t&&(--f[w],++h)}p=t}return{t:new Q(f),l:p}},De=function(e,t,n){return-1==e.s?Math.max(De(e.l,t,n+1),De(e.r,t,n+1)):t[e.s]=n},Te=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new Y(++t),i=0,r=e[0],s=1,a=function(e){n[i++]=e},o=1;o<=t;++o)if(e[o]==r&&o!=t)++s;else{if(!r&&s>2){for(;s>138;s-=138)a(32754);s>2&&(a(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(a(r),--s;s>6;s-=6)a(8304);s>2&&(a(s-3<<5|8208),s=0)}for(;s--;)a(r);s=1,r=e[o]}return{c:n.subarray(0,i),n:t}},xe=function(e,t){for(var n=0,i=0;i<t.length;++i)n+=e[i]*t[i];return n},Pe=function(e,t,n){var i=n.length,r=be(t+2);e[r]=255&i,e[r+1]=i>>8,e[r+2]=255^e[r],e[r+3]=255^e[r+1];for(var s=0;s<i;++s)e[r+s+4]=n[s];return 8*(r+4+i)},Me=function(e,t,n,i,r,s,a,o,c,l,d){Se(t,d++,n),++r[256];for(var u=Ie(r,15),g=u.t,f=u.l,p=Ie(s,15),h=p.t,m=p.l,b=Te(g),v=b.c,y=b.n,w=Te(h),S=w.c,E=w.n,I=new Y(19),D=0;D<v.length;++D)++I[31&v[D]];for(D=0;D<S.length;++D)++I[31&S[D]];for(var T=Ie(I,7),x=T.t,P=T.l,M=19;M>4&&!x[ne[M-1]];--M);var $,_,U,k,C=l+5<<3,A=xe(r,fe)+xe(s,pe)+a,O=xe(r,g)+xe(s,h)+a+14+3*M+xe(I,x)+2*I[16]+3*I[17]+7*I[18];if(c>=0&&C<=A&&C<=O)return Pe(t,d,e.subarray(c,c+l));if(Se(t,d,1+(O<A)),d+=2,O<A){$=ge(g,f,0),_=g,U=ge(h,m,0),k=h;var z=ge(x,P,0);Se(t,d,y-257),Se(t,d+5,E-1),Se(t,d+10,M-4),d+=14;for(D=0;D<M;++D)Se(t,d+3*D,x[ne[D]]);d+=3*M;for(var L=[v,S],G=0;G<2;++G){var N=L[G];for(D=0;D<N.length;++D){var V=31&N[D];Se(t,d,z[V]),d+=x[V],V>15&&(Se(t,d,N[D]>>5&127),d+=N[D]>>12)}}}else $=he,_=fe,U=me,k=pe;for(D=0;D<o;++D){var R=i[D];if(R>255){Ee(t,d,$[(V=R>>18&31)+257]),d+=_[V+257],V>7&&(Se(t,d,R>>23&31),d+=ee[V]);var B=31&R;Ee(t,d,U[B]),d+=k[B],B>3&&(Ee(t,d,R>>5&8191),d+=te[B])}else Ee(t,d,$[R]),d+=_[R]}return Ee(t,d,$[256]),d+_[256]},$e=new Z([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),_e=new Q(0),Ue=function(e,t,n,i,r,s){var a=s.z||e.length,o=new Q(i+a+5*(1+Math.ceil(a/7e3))+r),c=o.subarray(i,o.length-r),l=s.l,d=7&(s.r||0);if(t){d&&(c[0]=s.r>>3);for(var u=$e[t-1],g=u>>13,f=8191&u,p=(1<<n)-1,h=s.p||new Y(32768),m=s.h||new Y(p+1),b=Math.ceil(n/3),v=2*b,y=function(t){return(e[t]^e[t+1]<<b^e[t+2]<<v)&p},w=new Z(25e3),S=new Y(288),E=new Y(32),I=0,D=0,T=s.i||0,x=0,P=s.w||0,M=0;T+2<a;++T){var $=y(T),_=32767&T,U=m[$];if(h[_]=U,m[$]=_,P<=T){var k=a-T;if((I>7e3||x>24576)&&(k>423||!l)){d=Me(e,c,0,w,S,E,D,x,M,T-M,d),x=I=D=0,M=T;for(var C=0;C<286;++C)S[C]=0;for(C=0;C<30;++C)E[C]=0}var A=2,O=0,z=f,L=_-U&32767;if(k>2&&$==y(T-L))for(var G=Math.min(g,k)-1,N=Math.min(32767,T),V=Math.min(258,k);L<=N&&--z&&_!=U;){if(e[T+A]==e[T+A-L]){for(var R=0;R<V&&e[T+R]==e[T+R-L];++R);if(R>A){if(A=R,O=L,R>G)break;var B=Math.min(L,R-2),F=0;for(C=0;C<B;++C){var W=T-L+C&32767,j=W-h[W]&32767;j>F&&(F=j,U=W)}}}L+=(_=U)-(U=h[_])&32767}if(O){w[x++]=268435456|ae[A]<<18|ce[O];var J=31&ae[A],q=31&ce[O];D+=ee[J]+te[q],++S[257+J],++E[q],P=T+A,++I}else w[x++]=e[T],++S[e[T]]}}for(T=Math.max(T,P);T<a;++T)w[x++]=e[T],++S[e[T]];d=Me(e,c,l,w,S,E,D,x,M,T-M,d),l||(s.r=7&d|c[d/8|0]<<3,d-=7,s.h=m,s.p=h,s.i=T,s.w=P)}else{for(T=s.w||0;T<a+l;T+=65535){var H=T+65535;H>=a&&(c[d/8|0]=l,H=a),d=Pe(c,d+1,e.subarray(T,H))}s.i=a}return ve(o,0,i+be(d)+r)},ke=function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var n=t,i=9;--i;)n=(1&n&&-306674912)^n>>>1;e[t]=n}return e}(),Ce=function(){var e=-1;return{p:function(t){for(var n=e,i=0;i<t.length;++i)n=ke[255&n^t[i]]^n>>>8;e=n},d:function(){return~e}}},Ae=function(e,t,n,i,r){if(!r&&(r={l:1},t.dictionary)){var s=t.dictionary.subarray(-32768),a=new Q(s.length+e.length);a.set(s),a.set(e,s.length),e=a,r.w=s.length}return Ue(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,n,i,r)},Oe=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8},ze=function(e,t){var n=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&Oe(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),n){e[3]=8;for(var i=0;i<=n.length;++i)e[i+10]=n.charCodeAt(i)}},Le=function(e){return 10+(e.filename?e.filename.length+1:0)};function Ge(e,t){t||(t={});var n=Ce(),i=e.length;n.p(e);var r=Ae(e,t,Le(t),8),s=r.length;return ze(r,t),Oe(r,s-8,n.d()),Oe(r,s-4,i),r}var Ne="undefined"!=typeof TextEncoder&&new TextEncoder,Ve="undefined"!=typeof TextDecoder&&new TextDecoder;try{Ve.decode(_e,{stream:!0})}catch(En){}function Re(e,t){if(t){for(var n=new Q(e.length),i=0;i<e.length;++i)n[i]=e.charCodeAt(i);return n}if(Ne)return Ne.encode(e);var r=e.length,s=new Q(e.length+(e.length>>1)),a=0,o=function(e){s[a++]=e};for(i=0;i<r;++i){if(a+5>s.length){var c=new Q(a+8+(r-i<<1));c.set(s),s=c}var l=e.charCodeAt(i);l<128||t?o(l):l<2048?(o(192|l>>6),o(128|63&l)):l>55295&&l<57344?(o(240|(l=65536+(1047552&l)|1023&e.charCodeAt(++i))>>18),o(128|l>>12&63),o(128|l>>6&63),o(128|63&l)):(o(224|l>>12),o(128|l>>6&63),o(128|63&l))}return ve(s,0,a)}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;const Be="core.Pings.Database";function Fe(e){return e.path.split("/")[3]===W}function We(e){return Re(JSON.stringify(e)).length}function je(e){if(T(e)){const t="collectionDate"in e&&P(e.collectionDate)&&$(new Date(e.collectionDate).getTime()),n="path"in e&&P(e.path),i="payload"in e&&D(e.payload)&&T(e.payload),r=!("headers"in e)||D(e.headers)&&T(e.headers);return!!(t&&n&&i&&r)}return!1}var Je=class{constructor(){this.store=new l.platform.Storage("pings")}attachObserver(e){this.observer=e}recordPing(e,t,n,i){const r={collectionDate:(new Date).toISOString(),path:e,payload:n};i&&(r.headers=i),this.store.update([t],(()=>r)),this.observer&&this.observer.update(t,r)}deletePing(e){this.store["delete"]([e])}getAllPings(){const n=this.store.get(),i={};if(T(n))for(const r in n){const s=n[r];je(s)?i[r]=s:(t(Be,`Unexpected data found in pings database: ${JSON.stringify(s,null,2)}. Deleting.`,e.Warn),this.store["delete"]([r]))}return r=i,Object.entries(r).sort((([e,{collectionDate:t}],[n,{collectionDate:i}])=>new Date(t).getTime()-new Date(i).getTime()));var r}scanPendingPings(){if(!this.observer)return;const e=this.getAllPingsWithoutSurplus();for(const[t,n]of e)this.observer.update(t,n)}clearAll(){this.store["delete"]([])}getAllPingsWithoutSurplus(n=250,i=10485760){const r=this.getAllPings(),s=r.filter((([e,t])=>!Fe(t))).reverse(),a=r.filter((([e,t])=>Fe(t))),o=s.length;o>n&&t(Be,[`More than ${n} pending pings in the pings database,`,`will delete ${o-n} old pings.`],e.Warn);let c=!1,l=0,d=0;const u=[];for(const[r,a]of s)l++,d+=We(a),!c&&d>i&&(t(Be,[`Pending pings database has reached the size quota of ${i} bytes,`,"outstanding pings will be deleted."],e.Warn),c=!0),l>n&&(c=!0),c?this.deletePing(r):u.unshift([r,a]);return[...a,...u]}};var qe;!function(e){e[e.Incrementing=0]="Incrementing",e[e.Throttled=1]="Throttled"}(qe||(qe={}));var He=class{constructor(e=6e4,t=40,n=0,i){this.interval=e,this.maxCount=t,this.count=n,this.started=i}get elapsed(){if(x(this.started))return NaN;const e=C()-this.started;return e<0?NaN:e}reset(){this.started=C(),this.count=0}shouldReset(){return!!x(this.started)||!!(isNaN(this.elapsed)||this.elapsed>this.interval)}getState(){this.shouldReset()&&this.reset();const e=this.interval-this.elapsed;return this.count>=this.maxCount?{state:1,remainingTime:e}:(this.count++,{state:0})}};class Ke{constructor(e=3,t=3,n=1048576){this.maxWaitAttempts=e,this.maxRecoverableFailures=t,this.maxPingBodySize=n}}class Xe extends Error{constructor(e){super(e),this.name="PingBodyOverflow"}}class Qe{constructor(e,t,n,i){this.identifier=e,this.headers=t,this.payload=n,this.maxBodySize=i}asCompressedPayload(){if("gzip"==this.headers["Content-Encoding"])return this;const e=Re(this.payload);let t;const n=this.headers;try{t=Ge(e),n["Content-Encoding"]="gzip",n["Content-Length"]=t.length.toString()}catch(re){return this}if(t.length>this.maxBodySize)throw new Xe(`Body for ping ${this.identifier} exceeds ${this.maxBodySize} bytes. Discarding.`);return new Qe(this.identifier,n,t,this.maxBodySize)}}const Ye="core.Upload.PingUploadWorker";var Ze,et=class{constructor(e,t,n=new Ke){this.uploader=e,this.serverEndpoint=t,this.policy=n,this.isBlocking=!1}buildPingRequest(e){let t=e.headers||{};t={...e.headers,"Content-Type":"application/json; charset=utf-8",Date:(new Date).toISOString(),"X-Telemetry-Agent":`Glean/${V} (JS on ${l.platform.info.os()})`};const n=JSON.stringify(e.payload);if(n.length>this.policy.maxPingBodySize)throw new Xe(`Body for ping ${e.identifier} exceeds ${this.policy.maxPingBodySize}bytes. Discarding.`);return t["Content-Length"]=n.length.toString(),new Qe(e.identifier,t,n,this.policy.maxPingBodySize)}async attemptPingUpload(n){try{const e=this.buildPingRequest(n);return this.uploader.post(`${this.serverEndpoint}${n.path}`,e)}catch(En){return t(Ye,["Error trying to build or post ping request:",En],e.Warn),new i(1)}}work(n,i){for(;;)try{const e=n();switch(e.type){case"upload":if(this.isBlocking)return;this.attemptPingUpload(e.ping).then((t=>{i(e.ping,t)}))["catch"]((e=>{console.log(e)}));continue;case"done":return}}catch(r){t(Ye,["IMPOSSIBLE: Something went wrong while processing ping upload tasks.",r],e.Error)}}blockUploading(){this.isBlocking=!0}resumeUploading(){this.isBlocking=!1}};!function(e){e.Done="done",e.Wait="wait",e.Upload="upload"}(Ze||(Ze={}));var tt=()=>({type:"done"}),nt=e=>({type:"wait",remainingTime:e}),it=e=>({type:"upload",ping:e});const rt="core.Upload.PingUploadManager";var st=class{constructor(e,t,n=new Ke,i=new He){this.pingsDatabase=t,this.policy=n,this.rateLimiter=i,this.recoverableFailureCount=0,this.waitAttemptCount=0,this.queue=[],this.processing=new Set,this.worker=new et(e.httpClient?e.httpClient:l.platform.uploader,e.serverEndpoint,n),t.attachObserver(this)}getUploadTask(){const e=this.getUploadTaskInternal();return"wait"!==e.type&&this.waitAttemptCount>0&&(this.waitAttemptCount=0),"upload"!==e.type&&this.recoverableFailureCount>0&&(this.recoverableFailureCount=0),e}processPingUploadResponse(n,i){const{identifier:r}=n;this.processing.has(r)&&this.processing["delete"](r);const{status:s,result:a}=i;return s&&s>=200&&s<300?(t(rt,`Ping ${r} successfully sent ${s}.`,e.Info),void this.pingsDatabase.deletePing(r)):1===a||s&&s>=400&&s<500?(t(rt,`Unrecoverable upload failure while attempting to send ping ${r}. Error was: ${null!=s?s:"no status"}.`,e.Warn),void this.pingsDatabase.deletePing(r)):(t(rt,[`Recoverable upload failure while attempting to send ping ${r}, will retry.`,`Error was: ${null!=s?s:"no status"}.`],e.Warn),this.recoverableFailureCount++,void this.enqueuePing(n))}clearPendingPingsQueue(){this.queue=this.queue.filter((e=>Fe(e)))}blockUploads(){this.worker.blockUploading()}resumeUploads(){this.worker.resumeUploading()}update(e,t){this.enqueuePing({identifier:e,...t}),this.worker.isBlocking||(this.processing["delete"](e),this.pingsDatabase.deletePing(e)),this.worker.work((()=>this.getUploadTask()),((e,t)=>this.processPingUploadResponse(e,t)))}enqueuePing(e){if(!this.processing.has(e.identifier)){for(const t of this.queue)if(t.identifier===e.identifier)return;this.queue.push(e)}}getUploadTaskInternal(){if(this.recoverableFailureCount>=this.policy.maxRecoverableFailures)return t(rt,"Glean has reached maximum recoverable upload failures for the current uploading window.",e.Debug),tt();if(this.queue.length>0){const{state:n,remainingTime:i}=this.rateLimiter.getState();if(1===n)return t(rt,["Glean is currently throttled.",`Pending pings may be uploaded in ${(i||0)/1e3}s.`],e.Debug),this.waitAttemptCount++,this.waitAttemptCount>this.policy.maxWaitAttempts?tt():nt(i||0);const r=this.queue.shift();return this.processing.add(r.identifier),it(r)}return tt()}};class at extends I{constructor(e){super(e)}validate(e){return{type:w.Success}}payload(){return this.inner}}const ot="__other__",ct=/^[a-z_][a-z0-9_-]{0,29}(\.[a-z_][a-z0-9_-]{0,29})*$/;function lt(e,t){return`${e}/${t}`}class dt{constructor(e,t,n){n&&l.addSupportedMetric(e,n),this.type=e,this.name=t.name,this.category=t.category,this.sendInPings=t.sendInPings,this.lifetime=t.lifetime,this.disabled=t.disabled,this.dynamicLabel=t.dynamicLabel}baseIdentifier(){return this.category.length>0?`${this.category}.${this.name}`:this.name}identifier(){const e=this.baseIdentifier();return x(this.dynamicLabel)?e:function(e){if(e.dynamicLabel===undefined)throw new Error("This point should never be reached.");const t=lt(e.baseIdentifier(),e.dynamicLabel);for(const n of e.sendInPings)if(l.metricsDatabase.hasMetric(e.lifetime,n,e.type,t))return t;let n=0;for(const t of e.sendInPings)n+=l.metricsDatabase.countByBaseIdentifier(e.lifetime,t,e.type,e.baseIdentifier());let i=!1;return n>=16?i=!0:e.dynamicLabel.length>61?(i=!0,l.errorManager.record(e,y.InvalidLabel,`Label length ${e.dynamicLabel.length} exceeds maximum of 61.`)):ct.test(e.dynamicLabel)||(i=!0,l.errorManager.record(e,y.InvalidLabel,`Label must be snake_case, got '${e.dynamicLabel}'.`)),i?lt(e.baseIdentifier(),ot):t}(this)}shouldRecord(e){return e&&!this.disabled}testGetNumRecordedErrors(e,t=this.sendInPings[0]){return O("testGetNumRecordedErrors")?l.errorManager.testGetNumRecordedErrors(this,e,t):0}}function ut(e,t){e.startsWith("labeled_")&&l.addSupportedMetric(e,at);const n=l.getSupportedMetric(e);if(!n)throw new Error(`Unable to create metric of unknown type "${e}".`);return new n(t)}function gt(n,i){try{return ut(n,i),!0}catch(En){return t("Glean.core.Metrics.utils",En.message,e.Error),!1}}function ft(e){return P(e)?{type:w.Success}:{type:w.Error,errorMessage:`Expected string value, got ${JSON.stringify(e)}`}}var pt,ht=undefined&&undefined.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},mt=undefined&&undefined.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};const bt=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;class vt extends I{constructor(e){super(e)}validate(e){const t=ft(e);if(t.type===w.Error)return t;const n=e;return bt.test(n)?{type:w.Success}:{type:w.Error,errorMessage:`"${n}" is not a valid UUID`,errorType:y.InvalidValue}}payload(){return this.inner}}class yt extends dt{constructor(e){super("uuid",e,vt)}set(e){if(!this.shouldRecord(l.uploadEnabled))return;let t;e||(e=k());try{t=new vt(e),l.metricsDatabase.record(this,t)}catch(En){En instanceof E&&En.recordError(this)}}generateAndSet(){if(!this.shouldRecord(l.uploadEnabled))return;const e=k();return this.set(e),e}testGetValue(e=this.sendInPings[0]){if(O("testGetValue","core.metrics.UUIDMetricType"))return l.metricsDatabase.getMetric(e,this)}}var wt,St=class{constructor(e){pt.set(this,void 0),ht(this,pt,new yt(e),"f")}set(e){mt(this,pt,"f").set(e)}generateAndSet(){return mt(this,pt,"f").generateAndSet()}testGetValue(e=mt(this,pt,"f").sendInPings[0]){return mt(this,pt,"f").testGetValue(e)}testGetNumRecordedErrors(e,t=mt(this,pt,"f").sendInPings[0]){return mt(this,pt,"f").testGetNumRecordedErrors(e,t)}};pt=new WeakMap,function(e){e.Nanosecond="nanosecond",e.Microsecond="microsecond",e.Millisecond="millisecond",e.Second="second",e.Minute="minute",e.Hour="hour",e.Day="day"}(wt||(wt={}));var Et=wt;undefined&&undefined.__classPrivateFieldSet,undefined&&undefined.__classPrivateFieldGet;class It extends I{constructor(e){super(e)}static fromDate(e,t){if(!(e instanceof Date))throw new E(`Expected Date object, got ${JSON.stringify(e)}`);return new It({timeUnit:t,timezone:e.getTimezoneOffset(),date:e.toISOString()})}get date(){return new Date(this.inner.date)}get timezone(){return this.inner.timezone}get timeUnit(){return this.inner.timeUnit}get dateISOString(){return this.inner.date}validate(e){if(!T(e)||3!==Object.keys(e).length)return{type:w.Error,errorMessage:`Expected Glean datetime metric object, got ${JSON.stringify(e)}`};const t="timeUnit"in e&&P(e.timeUnit)&&Object.values(Et).includes(e.timeUnit),n="timezone"in e&&$(e.timezone),i="date"in e&&P(e.date)&&24===e.date.length&&!isNaN(Date.parse(e.date));return t&&n&&i?{type:w.Success}:{type:w.Error,errorMessage:`Invalid property on datetime metric, got ${JSON.stringify(e)}`}}payload(){const e=this.dateISOString.match(/\d+/g);if(!e||e.length<0)throw new Error("IMPOSSIBLE: Unable to extract date information from DatetimeMetric.");const t=new Date(parseInt(e[0]),parseInt(e[1])-1,parseInt(e[2]),parseInt(e[3])-this.timezone/60,parseInt(e[4]),parseInt(e[5]),parseInt(e[6])),n=function(e){const t=e/60*-1;return`${t>0?"+":"-"}${Math.abs(t).toString().padStart(2,"0")}:00`}(this.timezone),i=t.getFullYear().toString().padStart(2,"0"),r=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getDate().toString().padStart(2,"0");if(this.timeUnit===Et.Day)return`${i}-${r}-${s}${n}`;const a=t.getHours().toString().padStart(2,"0");if(this.timeUnit===Et.Hour)return`${i}-${r}-${s}T${a}${n}`;const o=t.getMinutes().toString().padStart(2,"0");if(this.timeUnit===Et.Minute)return`${i}-${r}-${s}T${a}:${o}${n}`;const c=t.getSeconds().toString().padStart(2,"0");if(this.timeUnit===Et.Second)return`${i}-${r}-${s}T${a}:${o}:${c}${n}`;const l=t.getMilliseconds().toString().padStart(3,"0");return this.timeUnit===Et.Millisecond?`${i}-${r}-${s}T${a}:${o}:${c}.${l}${n}`:this.timeUnit===Et.Microsecond?`${i}-${r}-${s}T${a}:${o}:${c}.${l}000${n}`:`${i}-${r}-${s}T${a}:${o}:${c}.${l}000000${n}`}}class Dt extends dt{constructor(e,t){super("datetime",e,It),this.timeUnit=t}set(e){if(!this.shouldRecord(l.uploadEnabled))return;const t=this.truncateDate(e);try{const e=It.fromDate(t,this.timeUnit);l.metricsDatabase.record(this,e)}catch(En){En instanceof E&&En.recordError(this)}}truncateDate(e){e||(e=new Date);const t=e;switch(this.timeUnit){case Et.Day:t.setMilliseconds(0),t.setSeconds(0),t.setMinutes(0),t.setMilliseconds(0);case Et.Hour:t.setMilliseconds(0),t.setSeconds(0),t.setMinutes(0);case Et.Minute:t.setMilliseconds(0),t.setSeconds(0);case Et.Second:t.setMilliseconds(0)}return t}testGetValueAsDatetimeMetric(e,t){if(O(t,"core.metrics.DatetimeMetricType")){const t=l.metricsDatabase.getMetric(e,this);if(t)return new It(t)}}testGetValueAsString(e=this.sendInPings[0]){const t=this.testGetValueAsDatetimeMetric(e,"testGetValueAsString");return t?t.payload():undefined}testGetValue(e=this.sendInPings[0]){const t=this.testGetValueAsDatetimeMetric(e,"testGetValue");return t?t.date:undefined}}new WeakMap;undefined&&undefined.__classPrivateFieldSet,undefined&&undefined.__classPrivateFieldGet;class Tt extends I{constructor(e){super(e)}validate(e){return ft(e)}payload(){return this.inner}}class xt extends dt{constructor(e){super("string",e,Tt)}set(e){if(this.shouldRecord(l.uploadEnabled))try{const t=A(this,e,100),n=new Tt(t);l.metricsDatabase.record(this,n)}catch(En){En instanceof E&&En.recordError(this)}}testGetValue(e=this.sendInPings[0]){if(O("testGetValue","core.metrics.StringMetricType"))return l.metricsDatabase.getMetric(e,this)}}new WeakMap;undefined&&undefined.__classPrivateFieldSet,undefined&&undefined.__classPrivateFieldGet;const Pt="core.metrics.CounterMetricType";class Mt extends I{constructor(e){super(e)}validate(e){return function(e,t=!0){return _(e)?(t?e<0:e<=0)?{type:w.Error,errorMessage:`Expected positive value, got ${JSON.stringify(e)}`,errorType:y.InvalidValue}:{type:w.Success}:{type:w.Error,errorMessage:`Expected integer value, got ${JSON.stringify(e)}`}}(e,!1)}payload(){return this.inner}saturatingAdd(e){const t=this.validateOrThrow(e);this.inner=function(...e){let t=e.reduce(((e,t)=>e+t),0);return t>Number.MAX_SAFE_INTEGER&&(t=Number.MAX_SAFE_INTEGER),t}(this.inner,t)}}class $t extends dt{constructor(e){super("counter",e,Mt)}add(e){if(this.shouldRecord(l.uploadEnabled)){x(e)&&(e=1);try{l.metricsDatabase.transform(this,this.transformFn(e))}catch(En){En instanceof E&&En.recordError(this)}}}transformFn(e){return n=>{const i=new Mt(e);if(n)try{i.saturatingAdd(n)}catch(re){t(Pt,`Unexpected value found in storage for metric ${this.name}: ${JSON.stringify(n)}. Overwriting.`)}return i}}testGetValue(e=this.sendInPings[0]){if(O("testGetValue",Pt))return l.metricsDatabase.getMetric(e,this)}}new WeakMap;class _t{constructor(){this.clientId=new yt({name:"client_id",category:"",sendInPings:["glean_client_info"],lifetime:"user",disabled:!1}),this.firstRunDate=new Dt({name:"first_run_date",category:"",sendInPings:["glean_client_info"],lifetime:"user",disabled:!1},Et.Day),this.os=new xt({name:"os",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.osVersion=new xt({name:"os_version",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.architecture=new xt({name:"architecture",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.locale=new xt({name:"locale",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.appChannel=new xt({name:"app_channel",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.appBuild=new xt({name:"app_build",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.appDisplayVersion=new xt({name:"app_display_version",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.buildDate=new Dt({name:"build_date",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1},"second"),this.sessionId=new yt({name:"session_id",category:"",sendInPings:["glean_client_info"],lifetime:"user",disabled:!1}),this.sessionCount=new $t({name:"session_count",category:"",sendInPings:["glean_client_info"],lifetime:"user",disabled:!1})}initialize(){!l.testing&&z()||(this.initializeClientId(),this.initializeFirstRunDate(),this.updateSessionInfo(),this.os.set(l.platform.info.os()),this.osVersion.set(l.platform.info.osVersion()),this.architecture.set(l.platform.info.arch()),this.locale.set(l.platform.info.locale()),this.appBuild.set(l.config.appBuild||"Unknown"),this.appDisplayVersion.set(l.config.appDisplayVersion||"Unknown"),l.config.channel&&this.appChannel.set(l.config.channel),l.config.buildDate&&this.buildDate.set())}updateSessionInfo(){if(z())return;if(l.metricsDatabase.getMetric(B,this.sessionId))try{(function(e=30){const t=localStorage.getItem("glean_session_last_active"),n=new Date(Number(t)),i=new Date;return i.setMinutes(i.getMinutes()-e),i>n})(l.config.sessionLengthInMinutesOverride)&&this.generateNewSession()}catch(En){this.generateNewSession()}else this.generateNewSession();localStorage.setItem("glean_session_last_active",Date.now().toString())}initializeClientId(){let n=!1;const i=l.metricsDatabase.getMetric(B,this.clientId);if(i)try{ut("uuid",i).payload()===F&&(n=!0)}catch(re){t("core.InternalMetrics","Unexpected value found for Glean clientId. Ignoring.",e.Warn),n=!0}else n=!0;n&&this.clientId.set(k())}initializeFirstRunDate(){l.metricsDatabase.getMetric(B,this.firstRunDate)||this.firstRunDate.set()}generateNewSession(){this.sessionId.generateAndSet(),this.sessionCount.add()}}const Ut="core.Pings.Maker";function kt(e){const{startTimeMetric:t,startTime:n}=function(e){const t=new Dt({category:"",name:`${e.name}#start`,sendInPings:[R],lifetime:"user",disabled:!1},Et.Minute),n=l.metricsDatabase.getMetric(R,t);let i;return i=n?new It(n):It.fromDate(l.startTime,Et.Minute),{startTimeMetric:t,startTime:i}}(e),i=new Date;t.set(i);const r=It.fromDate(i,Et.Minute);return{startTime:n.payload(),endTime:r.payload()}}function Ct(n,i){const r=function(n){const i=new $t({category:"",name:`${n.name}#sequence`,sendInPings:[R],lifetime:"user",disabled:!1}),r=l.metricsDatabase.getMetric(R,i);if(i.add(1),r)try{return new Mt(r).payload()}catch(En){t(Ut,`Unexpected value found for sequence number in ping ${n.name}. Ignoring.`,e.Warn)}return 0}(n),{startTime:s,endTime:a}=kt(n),o={seq:r,start_time:s,end_time:a};return i&&(o.reason=i),o}function At(n,i){const r=l.eventsDatabase.getPingEvents(n.name,!0);let s=l.metricsDatabase.getPingMetrics(n.name,!0);if(!s&&!r){if(!n.sendIfEmpty)return void t(Ut,`Storage for ${n.name} empty. Bailing out.`,e.Info);t(Ut,`Storage for ${n.name} empty. Ping will still be sent.`,e.Info)}n.includeClientId&&l.config.experimentationId&&(s=s!==undefined?{...s,string:{...(null==s?void 0:s.string)||undefined,"glean.client.annotation.experimentation_id":l.config.experimentationId}}:{string:{"glean.client.annotation.experimentation_id":l.config.experimentationId}});const a=s?{metrics:s}:{},o=r?{events:r}:{},c=Ct(n,i),d=function(n){let i=l.metricsDatabase.getPingMetrics(B,!0);i||(t(Ut,"Empty client info data. Will submit anyways.",e.Warn),i={});let r={telemetry_sdk_build:V};for(const e in i)r={...r,...i[e]};return n.includeClientId||(delete r.client_id,delete r.session_id),r}(n);return{...a,...o,ping_info:c,client_info:d}}var Ot=function(n,i,r){const s=At(i,r);if(!s)return;l.config.logPings&&t(Ut,JSON.stringify(s,null,2),e.Info);const a=function(){const e={};if(l.config.debugViewTag&&(e["X-Debug-ID"]=l.config.debugViewTag),l.config.sourceTags&&(e["X-Source-Tags"]=l.config.sourceTags.toString()),Object.keys(e).length>0)return e}();l.pingsDatabase.recordPing(function(e,t){return`/submit/${l.applicationId}/${t.name}/1/${e}`}(n,i),n,s,a)};undefined&&undefined.__classPrivateFieldSet,undefined&&undefined.__classPrivateFieldGet;const zt="core.Pings.PingType";class Lt{constructor(e){var t;this.name=e.name,this.includeClientId=e.includeClientId,this.sendIfEmpty=e.sendIfEmpty,this.reasonCodes=null!==(t=e.reasonCodes)&&void 0!==t?t:[],this.preciseTimestamps=e.preciseTimestamps}submit(n){this.testCallback?this.testCallback(n).then((()=>{this.internalSubmit(n,this.resolveTestPromiseFunction)}))["catch"]((i=>{t(zt,[`There was an error validating "${this.name}" (${null!=n?n:"no reason"}):`,i],e.Error),this.internalSubmit(n,this.rejectTestPromiseFunction)})):this.internalSubmit(n)}internalSubmit(n,i){if(!l.initialized)return void t(zt,"Glean must be initialized before submitting pings.",e.Info);if(!l.uploadEnabled&&this.name!==W)return void t(zt,"Glean disabled: not submitting pings. Glean may still submit the deletion-request ping.",e.Info);let r=n;n&&!this.reasonCodes.includes(n)&&(t(zt,`Invalid reason code ${n} from ${this.name}. Ignoring.`,e.Warn),r=undefined);const s=k();Ot(s,this,r),i&&(i(),this.resolveTestPromiseFunction=undefined,this.rejectTestPromiseFunction=undefined,this.testCallback=undefined)}async testBeforeNextSubmit(n){if(O("testBeforeNextSubmit",zt))return this.testCallback?void t(zt,`There is an existing test call for ping "${this.name}". Ignoring.`,e.Error):new Promise(((e,t)=>{this.resolveTestPromiseFunction=e,this.rejectTestPromiseFunction=t,this.testCallback=n}))}}new WeakMap;var Gt=class{constructor(){this.deletionRequest=new Lt({name:W,includeClientId:!0,sendIfEmpty:!0,reasonCodes:["at_init","set_upload_enabled"]}),this.events=new Lt({name:j,includeClientId:!0,sendIfEmpty:!1,reasonCodes:["startup","max_capacity"]})}};const Nt="core.Metrics.Database",Vt="reserved#",Rt=`glean.${Vt}`;var Bt=class{constructor(){this.userStore=new l.platform.Storage("userLifetimeMetrics"),this.pingStore=new l.platform.Storage("pingLifetimeMetrics"),this.appStore=new l.platform.Storage("appLifetimeMetrics")}record(e,t){this.transform(e,(()=>t))}transform(e,t){if(e.disabled)return;const n=this.chooseStore(e.lifetime),i=e.identifier();for(const r of e.sendInPings){const s=e=>t(e).get();n.update([r,e.type,i],s)}}hasMetric(e,t,n,i){return!x(this.chooseStore(e).get([t,n,i]))}countByBaseIdentifier(e,t,n,i){const r=this.chooseStore(e).get([t,n]);return x(r)?0:Object.keys(r).filter((e=>e.startsWith(i))).length}getMetric(n,i){const r=this.chooseStore(i.lifetime),s=i.identifier(),a=r.get([n,i.type,s]);return x(a)||gt(i.type,a)?a:(t(Nt,`Unexpected value found for metric ${s}: ${JSON.stringify(a)}. Clearing.`,e.Error),void r["delete"]([n,i.type,s]))}getPingMetrics(e,t){const n=this.getCorrectedPingData(e,"user"),i=this.getCorrectedPingData(e,"ping"),r=this.getCorrectedPingData(e,"application");t&&Object.keys(i).length>0&&this.clear("ping",e);const s={};for(const e of[n,i,r])for(const t in e)for(const n in e[t])n.startsWith(Rt)||(n.includes("/")?this.processLabeledMetric(s,t,n,e[t][n]):s[t]={...s[t],[n]:e[t][n]});return 0===Object.keys(s).length?void 0:function(e){const t={};for(const n in e){const i=e[n];t[n]={};for(const e in i){const r=ut(n,i[e]);t[n][e]=r.payload()}}return t}(s)}clear(e,t){const n=t?[t]:[];this.chooseStore(e)["delete"](n)}clearAll(){this.userStore["delete"]([]),this.pingStore["delete"]([]),this.appStore["delete"]([])}chooseStore(e){switch(e){case"user":return this.userStore;case"ping":return this.pingStore;case"application":return this.appStore}}getCorrectedPingData(n,i){const r=this.chooseStore(i),s=r.get([n]);if(x(s))return{};if(!T(s))return t(Nt,`Invalid value found in storage for ping "${n}". Deleting.`,e.Debug),r["delete"]([n]),{};const a={};for(const i in s){const o=s[i];if(T(o))for(const s in o)gt(i,o[s])?(a[i]||(a[i]={}),a[i][s]=o[s]):(t(Nt,`Invalid value "${JSON.stringify(o[s])}" found in storage for metric "${s}". Deleting.`,e.Debug),r["delete"]([n,i,s]));else t(Nt,`Unexpected data found in storage for metrics of type "${i}" in ping "${n}". Deleting.`,e.Debug),r["delete"]([n,i])}return a}processLabeledMetric(e,t,n,i){const r=`labeled_${t}`,s=n.split("/",2),a=s[0],o=s[1];if(r in e&&a in e[r]){const t=e[r][a];e[r][a]={...t,[o]:i}}else e[r]={...e[r],[a]:{[o]:i}}}};class Ft extends I{constructor(e){super(e)}static withTransformedExtras(e,t){const n=t(e.extra||{});return{category:e.category,name:e.name,timestamp:e.timestamp,extra:n&&Object.keys(n).length>0?n:undefined}}addExtra(e,t){this.inner.extra||(this.inner.extra={}),this.inner.extra[e]=t}withoutReservedExtras(){return Ft.withTransformedExtras(this.get(),(e=>Object.keys(e).filter((e=>!H.includes(e))).reduce(((t,n)=>(t[n]=e[n],t)),{})))}validate(e){if(!T(e))return{type:w.Error,errorMessage:"Expected Glean event object, got "+typeof e};const t="category"in e&&P(e.category),n="name"in e&&P(e.name);if(!t||!n)return{type:w.Error,errorMessage:`Unexpected value for "category" or "name" in event object: ${JSON.stringify(e)}`};if(!("timestamp"in e&&_(e.timestamp)&&e.timestamp>=0))return{type:w.Error,errorMessage:`Event timestamp must be a positive integer, got ${JSON.stringify(e)}`};if(e.extra){if(!T(e.extra))return{type:w.Error,errorMessage:"Expected Glean extras object, got "+typeof e};for(const[t,n]of Object.entries(e.extra)){const e=ft(t);if(e.type===w.Error)return e;if(!P(n)&&!$(n)&&!M(n))return{type:w.Error,errorMessage:`Unexpected value for extra key ${t}: ${JSON.stringify(n)}`}}}return{type:w.Success}}payload(){return Ft.withTransformedExtras(this.withoutReservedExtras(),(e=>Object.keys(e).reduce(((t,n)=>(t[n]=e[n].toString(),t)),{})))}}var Wt,jt=undefined&&undefined.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},Jt=undefined&&undefined.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};class qt extends dt{constructor(e,t){super("event",e),this.allowedExtraKeys=t}record(e,t=C()){if(!this.shouldRecord(l.uploadEnabled))return;const n=Date.now();try{const i=new Ft({category:this.category,name:this.name,timestamp:t,extra:e}),r={};if(e&&this.allowedExtraKeys)for(const[t,n]of Object.entries(e))this.allowedExtraKeys.includes(t)?P(n)?r[t]=A(this,n,500):r[t]=n:l.errorManager.record(this,y.InvalidValue,`Invalid key index: ${t}`);r.glean_timestamp=n.toString(),i.set({...i.get(),extra:r}),l.eventsDatabase.record(this,i)}catch(En){En instanceof E&&En.recordError(this)}}testGetValue(e=this.sendInPings[0]){if(O("testGetValue","core.metrics.EventMetricType")){const t=l.eventsDatabase.getEvents(e,this);return t?(t.forEach((e=>{e.extra&&(delete e.extra.glean_timestamp,0==Object.keys(e.extra).length&&(e.extra=undefined))})),t):t}}}class Ht{constructor(e,t){Wt.set(this,void 0),jt(this,Wt,new qt(e,t),"f")}record(e){Jt(this,Wt,"f").record(e)}testGetValue(e=Jt(this,Wt,"f").sendInPings[0]){return Jt(this,Wt,"f").testGetValue(e)}testGetNumRecordedErrors(e,t=Jt(this,Wt,"f").sendInPings[0]){return Jt(this,Wt,"f").testGetNumRecordedErrors(e,t)}}Wt=new WeakMap;const Kt="core.Metric.EventsDatabase";function Xt(e,t=l.startTime){Zt(e).record({[J]:t.toISOString()},0)}function Qt(e){P(e)||(e="");const t=new Date(e);if(isNaN(t.getTime()))throw new Error(`Error attempting to generate Date object from string: ${e}`);return t}function Yt(e){return new $t({...(t="execution_counter",{category:"glean",name:`${Vt}${t}`}),sendInPings:e.filter((e=>e!==j)),lifetime:"ping",disabled:!1});var t}function Zt(e){return new qt({category:"glean",name:"restarted",sendInPings:e.filter((e=>e!==j)),lifetime:"ping",disabled:!1},[J])}function en(e){var t,n;return!!(null===(n=null===(t=null==e?void 0:e.get())||void 0===t?void 0:t.extra)||void 0===n?void 0:n[J])}var tn=class{constructor(){this.initialized=!1,this.eventsStore=new l.platform.Storage("events")}initialize(){var e;if(this.initialized)return;const t=this.getAvailableStoreNames();if(t.includes(j)){const t=null!==(e=this.eventsStore.get([j]))&&void 0!==e?e:[];t.length>0&&t.length>=l.config.maxEvents&&l.corePings.events.submit("startup")}Yt(t).add(1),Xt(t),this.initialized=!0}record(e,t){if(!e.disabled)for(const n of e.sendInPings){const e=Yt([n]);let i=l.metricsDatabase.getMetric(n,e);i||(e.add(1),i=1,Xt([n],new Date)),t.addExtra(q,i);let r=0;const s=e=>{var n;const i=null!==(n=e)&&void 0!==n?n:[];return i.push(t.get()),r=i.length,i};this.eventsStore.update([n],s),n===j&&r>=l.config.maxEvents&&l.corePings.events.submit("max_capacity")}}getEvents(e,t){const n=this.getAndValidatePingData(e);if(0!==n.length)return n.filter((e=>e.get().category===t.category&&e.get().name===t.name)).map((e=>e.withoutReservedExtras()))}getPingEvents(e,t){const n=this.getAndValidatePingData(e);if(t&&Object.keys(n).length>0&&this.eventsStore["delete"]([e]),0===n.length)return;const i=this.prepareEventsPayload(e,n);return i.length>0?i:void 0}clearAll(){this.eventsStore["delete"]([])}getAvailableStoreNames(){const e=this.eventsStore.get([]);return x(e)?[]:Object.keys(e)}getAndValidatePingData(n){const i=this.eventsStore.get([n]);return x(i)?[]:Array.isArray(i)?i.reduce(((e,n)=>{try{const t=new Ft(n);return[...e,t]}catch(re){return t(Kt,`Unexpected data found in events storage: ${JSON.stringify(n)}. Ignoring.`),e}}),[]):(t(Kt,`Unexpected value found for ping ${n}: ${JSON.stringify(i)}. Clearing.`,e.Error),this.eventsStore["delete"]([n]),[])}prepareEventsPayload(e,t){var n,i,r,s;let a,o=t.sort(((e,t)=>{var n,i;const r=Number(null===(n=e.get().extra)||void 0===n?void 0:n[q]),s=Number(null===(i=t.get().extra)||void 0===i?void 0:i[q]);return r!==s?r-s:e.get().timestamp-t.get().timestamp}));try{a=Qt(null===(n=o[0].get().extra)||void 0===n?void 0:n[J]),o.shift()}catch(u){a=l.startTime}const c=(null===(i=o[0])||void 0===i?void 0:i.get().timestamp)||0;let d=0;for(const[t,n]of o.entries()){try{const i=Qt(null===(r=n.get().extra)||void 0===r?void 0:r[J]),s=i.getTime()-a.getTime();a=i;const c=d+s,u=o[t-1].get().timestamp;c<=u?(d=u+1,l.errorManager.record(Zt([e]),y.InvalidValue,`Invalid time offset between application sessions found for ping "${e}". Ignoring.`)):d=c}catch(g){}let i;i=1===Number((null===(s=n.get().extra)||void 0===s?void 0:s[q])||1)?n.get().timestamp-c:n.get().timestamp+d,o[t]=new Ft({category:n.get().category,name:n.get().name,timestamp:i,extra:n.get().extra})}return o=function(e){for(;e.length&&en(e[e.length-1]);)e.pop();return e}(o),o.map((e=>e.payload()))}};function nn(e,t){const n=function(e){return e.split("/")[0]}(e.baseIdentifier());return new $t({name:lt(t,n),category:"glean.error",lifetime:"ping",sendInPings:e.sendInPings,disabled:!1})}class rn{record(e,n,i,r=1){const s=nn(e,n);t(function(e){return`core.metrics.${e.type.charAt(0).toUpperCase()+e.type.slice(1)}`}(e),[`${e.baseIdentifier()}:`,i]),r>0&&s.add(r)}testGetNumRecordedErrors(e,t,n){return nn(e,t).testGetValue(n)||0}}const sn="core.glean_metrics";var an;!function(n){const i={pageLoad:new Ht({category:"glean",name:"page_load",sendInPings:[j],lifetime:"ping",disabled:!1},["url","referrer","title"]),elementClick:new Ht({category:"glean",name:"element_click",sendInPings:[j],lifetime:"ping",disabled:!1},["id","type","label"]),pageId:new St({category:"glean",name:"page_id",sendInPings:[j],lifetime:"application",disabled:!1})};function r(n){l.initialized?i.elementClick.record(n):t(sn,"Attempted to record element click event before Glean was initialized. This is a no-op.",e.Warn)}n.pageLoad=function(n){var r,s,a;l.initialized?(i.pageId.generateAndSet(),i.pageLoad.record({url:null!==(r=null==n?void 0:n.url)&&void 0!==r?r:"undefined"!=typeof window?window.location.href:"URL_NOT_PROVIDED_OR_AVAILABLE",referrer:null!==(s=null==n?void 0:n.referrer)&&void 0!==s?s:"undefined"!=typeof document?document.referrer:"REFERRER_NOT_PROVIDED_OR_AVAILABLE",title:null!==(a=null==n?void 0:n.title)&&void 0!==a?a:"undefined"!=typeof document?document.title:"TITLE_NOT_PROVIDED_OR_AVAILABLE"})):t(sn,"Attempted to record a page load event before Glean was initialized. This is a no-op.",e.Warn)},n.handleClickEvent=function(e){const t=e.target.closest("[data-glean-id], [data-glean-type], [data-glean-label]");if(!t)return;r(function(e){const t=e.dataset;return{...t.gleanId&&{id:t.gleanId},...t.gleanType&&{type:t.gleanType},...t.gleanLabel&&{label:t.gleanLabel}}}(t))},n.recordElementClick=r}(an||(an={}));var on=an;const cn="core.Glean";var ln;!function(e){e.DebugTag="DebugTag",e.SourceTags="SourceTags",e.LogPings="LogPings"}(ln||(ln={}));const dn=(e,t)=>{const n=`Glean.${e.toString()}`;switch(e){case ln.DebugTag:sessionStorage.setItem(n,t);break;case ln.LogPings:sessionStorage.setItem(n,t.toString());break;case ln.SourceTags:sessionStorage.setItem(n,t.join(","))}},un=e=>sessionStorage.getItem(`Glean.${e.toString()}`)||undefined;var gn;!function(n){function i(){l.uploadEnabled=!0,n.pingUploader.resumeUploads()}function r(e){let t;t=e?"at_init":"set_upload_enabled",l.uploadEnabled=!1,l.corePings.deletionRequest.submit(t),s()}function s(){let e;n.pingUploader.clearPendingPingsQueue();try{e=new It(l.metricsDatabase.getMetric(B,l.coreMetrics.firstRunDate)).date}catch(re){e=new Date}l.eventsDatabase.clearAll(),l.metricsDatabase.clearAll(),l.pingsDatabase.clearAll(),l.uploadEnabled=!0,l.coreMetrics.clientId.set(F),l.coreMetrics.firstRunDate.set(e),l.uploadEnabled=!1}function a(){if("undefined"==typeof window||"undefined"==typeof window.sessionStorage)return;const e=un(ln.LogPings);var t;e&&(n.preInitLogPings="true"===(t=e).toLowerCase()||"false"!==t.toLowerCase()&&undefined);const i=un(ln.DebugTag);i&&(n.preInitDebugViewTag=i);const r=un(ln.SourceTags);r&&(n.preInitSourceTags=r.split(","))}n.initialize=function(o,c,d){if(l.initialized)t(cn,"Attempted to initialize Glean, but it has already been initialized. Ignoring.",e.Warn);else if(P(o))if(M(c))if(0!==o.length)if(l.platform){if(l.coreMetrics=new _t,l.corePings=new Gt,l.applicationId=function(e){return e.replace(/[^a-z0-9]+/gi,"-").toLowerCase()}(o),l.config=new X(d),a(),n.preInitLogPings&&(l.config.logPings=n.preInitLogPings),n.preInitDebugViewTag&&(l.config.debugViewTag=n.preInitDebugViewTag),n.preInitSourceTags&&(l.config.sourceTags=n.preInitSourceTags),l.metricsDatabase=new Bt,l.eventsDatabase=new tn,l.pingsDatabase=new Je,l.errorManager=new rn,n.pingUploader=new st(l.config,l.pingsDatabase),l.initialized=!0,l.uploadEnabled=c,l.eventsDatabase.initialize(),c)l.metricsDatabase.clear("application"),i(),l.coreMetrics.initialize(),(null==d?void 0:d.enableAutoPageLoadEvents)&&on.pageLoad(),(null==d?void 0:d.enableAutoElementClickEvents)&&document.addEventListener("click",(e=>{on.handleClickEvent(e)}));else{const e=l.metricsDatabase.getMetric(B,l.coreMetrics.clientId);e?e!==F&&r(!0):s()}l.pingsDatabase.scanPendingPings()}else t(cn,"Unable to initialize Glean, platform has not been set.",e.Error);else t(cn,"Unable to initialize Glean, applicationId cannot be an empty string.",e.Error);else t(cn,"Unable to initialize Glean, uploadEnabled must be a boolean.",e.Error);else t(cn,"Unable to initialize Glean, applicationId must be a string.",e.Error)},n.setUploadEnabled=function(n){l.initialized?M(n)?l.uploadEnabled!==n&&(n?(i(),l.coreMetrics.initialize()):r(!1)):t(cn,"Unable to change upload state, new value must be a boolean. Ignoring.",e.Error):t(cn,["Changing upload enabled before Glean is initialized is not supported.\n","Pass the correct state into `initialize`.\n","See documentation at https://mozilla.github.io/glean/book/user/general-api.html#initializing-the-glean-sdk`"],e.Error)},n.setExperimentationId=function(e){l.config.experimentationId=e},n.setLogPings=function(e){l.initialized?l.config.logPings=e:n.preInitLogPings=e},n.setDebugViewTag=function(e){l.initialized?l.config.debugViewTag=e:n.preInitDebugViewTag=e},n.setSourceTags=function(e){l.initialized?l.config.sourceTags=e:n.preInitSourceTags=e},n.setPlatform=function(n){l.initialized||(l.isPlatformSet()&&l.platform.name!==n.name&&!l.testing&&t(cn,[`IMPOSSIBLE: Attempted to change Glean's targeted platform",\n            "from "${l.platform.name}" to "${n.name}". Ignoring.`],e.Error),l.platform=n)}}(gn||(gn={})),"undefined"!=typeof window&&"undefined"!=typeof window.sessionStorage&&(window.Glean={setLogPings:e=>{dn(ln.LogPings,e),gn.setLogPings(e),console.log("Pings will be logged to the console until this tab is closed.")},setDebugViewTag:e=>{dn(ln.DebugTag,e),gn.setDebugViewTag(e),console.log("Pings will be sent to the Debug Ping Viewer until this tab is closed. Pings can be found here: https://debug-ping-preview.firebaseapp.com/.")},setSourceTags:e=>{dn(ln.SourceTags,e),gn.setSourceTags(e),console.log("Pings will be given the specified tags until the tab is closed.")},debugSession:()=>{const e=l.metricsDatabase.getMetric(B,l.coreMetrics.sessionId);e&&"string"==typeof e&&l.config.debugViewTag?window.open(`https://debug-ping-preview.firebaseapp.com/stream/${l.config.debugViewTag}#${e}`,"_blank"):console.info("You must set a debug tag via `window.Glean.setDebugViewTag` before debugging your session.")}});var fn=gn;var pn,hn=(pn=N,{initialize(e,t,n){fn.setPlatform(pn),fn.initialize(e,t,n)},setUploadEnabled(e){fn.setUploadEnabled(e)},setLogPings(e){fn.setLogPings(e)},setDebugViewTag(e){fn.setDebugViewTag(e)},setSourceTags(e){fn.setSourceTags(e)}});const mn=new Ht({category:"page",name:"interaction",sendInPings:["events"],lifetime:"ping",disabled:!1},["label","type"]),bn=new Ht({category:"page",name:"non_interaction",sendInPings:["events"],lifetime:"ping",disabled:!1},["label","type"]);function vn(e){return vn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vn(e)}var yn="moz-consent-pref";function wn(){try{return JSON.parse(window.Mozilla.Cookies.getItem(yn))}catch(En){return!1}}var Sn={filterURL:function(e){try{var t=new URL(e);return["/newsletter/existing/","/newsletter/country/"].forEach((function(e){var n=t.pathname.indexOf(e);if(-1!==n){var i=t.pathname.substring(0,n+e.length);t.pathname=i}})),t.toString()}catch(En){return e}},isFirefoxDownloadThanks:function(){return"string"==typeof(e=window.location.href)&&e.indexOf("/firefox/download/thanks/")>-1;var e},initGlean:function(e){var t=window.location.href,n="https://www.mozilla.org",i=t.startsWith(n)?"prod":"non-prod";t.includes("automation=true")&&hn.setSourceTags(["automation"]),hn.initialize("bedrock",e,{channel:i,serverEndpoint:n,enableAutoElementClickEvents:!0})},initPageLoadEvent:function(){on.pageLoad({url:Sn.filterURL(window.location.href),referrer:Sn.filterURL(document.referrer)})},initHelpers:function(){"undefined"==typeof window.Mozilla&&(window.Mozilla={}),window.Mozilla.Glean={pageEvent:function(e){try{!function(e){if("object"===vn(e)||"string"==typeof e.label){var t={label:e.label,type:""};"string"==typeof e.type&&(t.type=e.type);try{"boolean"==typeof e.nonInteraction&&!0===e.nonInteraction?bn.record(t):mn.record(t)}catch(En){}}}(e)}catch(En){}},clickEvent:function(e){try{on.recordElementClick(e)}catch(En){}}}},configureGlean:function(e){Sn.initGlean(e),e&&(Sn.initPageLoadEvent(),Sn.initHelpers())},handleConsent:function(e){Sn.configureGlean(e.detail.analytics),window.removeEventListener("mozConsentStatus",Sn.handleConsent,!1)},bootstrapGlean:function(){if((i=document.getElementsByTagName("html")[0].getAttribute("data-needs-consent"))&&"true"===i.toLowerCase()){var e=wn();Sn.isFirefoxDownloadThanks(window.location.href)&&e&&e.analytics?Sn.configureGlean(e.analytics):window.addEventListener("mozConsentStatus",Sn.handleConsent,!1)}else{var t=wn(),n=!t||t.analytics;Sn.configureGlean(n)}var i}};Sn.bootstrapGlean()}();