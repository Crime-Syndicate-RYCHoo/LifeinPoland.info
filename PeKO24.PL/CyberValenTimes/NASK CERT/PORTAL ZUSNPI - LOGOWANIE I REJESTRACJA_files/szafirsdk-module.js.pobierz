function appendAsyncSzafirAppletResultPart(a){SZAFIR_SDK.SzafirAppletResultPartHandler(a)}function setAsyncSzafirAppletResult(a){SZAFIR_SDK.SzafirAppletResultHandler(a)}function setAsyncSzafirAppletError(a){SZAFIR_SDK.SzafirAppletErrorHandler(a)}var SZAFIR_SDK=(function(w,H){var aa={version:"2.0.5"};var l={load:"load",unload:"unload",startComponentURI:"startComponentURI",startComponent:"startComponent",getTaskListURI:"getTaskListURI",getTaskList:"getTaskList",doTaskList:"doTaskList",doTaskListNoWindow:"doTaskListNoWindow",doTaskListNoWindow1Pass:"doTaskListNoWindow1Pass",doTaskListNoWindow2Pass:"doTaskListNoWindow2Pass",doTaskListURI:"doTaskListURI",doTaskListNoWindowURI:"doTaskListNoWindowURI",doTaskListNoWindow1PassURI:"doTaskListNoWindow1PassURI",doTaskListNoWindow2PassURI:"doTaskListNoWindow2PassURI",isCardInReader:"isCardInReader",getSignatureInfo:"getSignatureInfo",listCertificates:"listCertificates",test:"test",error:"error",disconnected:"disconnected"},W={ok:"OK",error:"ERROR"},X={notInstalled:"NOT_INSTALLED",notUpdated:"NOT_UPDATED"};var f={firefox_ver:52,opera_ver:34};var af={firefox_ext:"https://www.elektronicznypodpis.pl/download/webmodule/firefox/szafir_sdk_web-0.0.9-anfx.xpi",chrome_ext:"https://chrome.google.com/webstore/detail/podpis-elektroniczny-szaf/gjalhnomhafafofonpdihihjnbafkipc/",opera_ext:"https://addons.opera.com/pl/extensions/details/podpis-elektroniczny-szafir-sdk/"};var J=navigator.userAgent.toLowerCase(),ae=/\bchrome/.test(J)&&!/\bedge/.test(J)&&/google/.test(navigator.vendor.toLowerCase()),s=/\bWin64/.test(navigator.userAgent)||/\bWOW64/.test(navigator.userAgent),x=false,u=false,K=!ae,g=false,D;if(ae){var Y=J.match(/\bopr\/(\d+)/);if(Y!=null){if(parseInt(Y[1])>=f.opera_ver){x=true}else{ae=false;K=!ae}}}else{var Y=J.match(/\bfirefox\/(\d+)/);if(Y!=null){u=true;if(parseInt(Y[1])>=f.firefox_ver){ae=true;K=!ae}}}var ac,k={document_base_url:window.location.href,debug:false,webmodule_location_url:"szafirsdk_web/",sdk_location_url:"szafir_build_directory/",versions_file:"versions.xml",onError:undefined,onErrorNoExtension:undefined,onErrorNoHostApp:undefined,onDisconnected:function(){console.log("********** DEFAULT onDisconnected HANDLER!!! **********")},js_version:aa.version},I=[],Z=false,V="",A,ab=function(m){d({result:m})};function U(m){if(k.debug===true){console.log(m)}}function O(ah,ai,ag){if(Z){U("MOD.js : busy...!!!");return false}Z=true;var m={proc:ah,successCallback:ai,errorCallback:ag};I.push(m);return true}function C(){var ag=I.shift();var m=ag.successCallback;Z=false;try{U("MOD.js : success callback [ "+ag.proc+" ]");m.apply(this,arguments)}catch(ah){k.onError("ERROR: callback dla funkcji "+ag.proc+" nie został zdefiniowany!!!")}}function z(ah){var ag=I.shift();var m=ag.errorCallback||k.onError;Z=false;if(m instanceof Function){m(ah)}else{U("ERROR: callback onError nie zdefiniowany!!!")}}function R(ag){var m=H.extend(ag,{type:"SZAFIR_WND_MSG"});window.postMessage(JSON.stringify(m),"*")}function d(ag){var m=H.extend(ag,{type:"SZAFIR_WND_MSG",status:W.error});window.postMessage(JSON.stringify(m),"*")}function S(ag){var m={type:"SZAFIR_EXT_MSG",params:ag};window.postMessage(JSON.stringify(m),"*")}function F(ag){if(ag.source!=window){return}var m=JSON.parse(ag.data);if(m.type&&m.type==="SZAFIR_WND_MSG"){if(m.status!==W.error){switch(m.command){case l.load:T(m);break;case l.disconnected:k.onDisconnected();break;default:C(m.result);break}}else{z(m.result)}}}function B(){if(window.addEventListener){window.addEventListener("message",F)}else{window.attachEvent("onmessage",F)}}function T(ag){switch(ag.result){case"LOADED":C();break;case"NOHOSTAPP":var m=ag.version_info.current||"";g=(m.match(/^VERSION/)!=null);D=ag.version_info.app_links;D.windows32=D.windows.replace(".msi","_x86.msi");var ai=(g?X.notUpdated:X.notInstalled);var ah={current_version:ag.version_info.current,required_version:ag.version_info.required,link:aa.getAppLink(),links:aa.getAppLinks()};c(ai,ah);break;case"ERROR":Z=false;z("Błąd inicjalizacji bibliotek Szafir SDK!\nSkontaktuj się z administratorem serwisu!");break}}function G(ag,m){U("MOD.js : ERROR -> Chrome Extension Not Installed");I.length=0;Z=false;if(k.onErrorNoExtension instanceof Function){k.onErrorNoExtension(ag,m)}else{H("body").append('<div id="szafirsdk-errors-overlay">');H("body").append('<div id="szafirsdk-errors-container">');H("#szafirsdk-errors-container").load(k.webmodule_location_url+"szafirsdk-error-noextension.html?_="+(new Date).valueOf(),function(){H("#szafirsdk-link-extension").focus()})}}function c(ag,m){U("MOD.js : ERROR -> Chrome Native Messaging Host Not Installed");I.length=0;Z=false;if(k.onErrorNoHostApp instanceof Function){k.onErrorNoHostApp(ag,m)}else{H("body").append('<div id="szafirsdk-errors-overlay">');H("body").append('<div id="szafirsdk-errors-container">');H("#szafirsdk-errors-container").load(k.webmodule_location_url+"szafirsdk-error-nohostapp.html?_="+(new Date).valueOf(),function(){H("#szafirsdk-link-installer").focus()})}}function h(m,ag){var ah=document.createElement("param");ah.name=m;ah.value=ag;return ah}function b(m){R({command:l.load,status:W.ok,result:"LOADED"})}function y(){U("MOD.js : APL_loadSzafir");A=b;if(ac!==undefined){U("SZAFIRSDK_APPLET_OBJECT został już załadowany!");H("#SZAFIRSDK_APPLET_OBJECT").remove();ac=undefined}var m=document.createElement("object");m.id="SZAFIRSDK_APPLET_OBJECT";m.classid="clsid:8AD9C840-044E-11D1-B3E9-00805F499D93";m.name=m.id;m.type="application/x-java-applet";m.style.cssText="margin:0; padding:0; width: 1px; height: 1px; float: left;";m.appendChild(h("code","pl.com.kir.crypto.applet.CryptoApplet.class"));m.appendChild(h("codebase",k.sdk_location_url));m.appendChild(h("archive","cryptoapplet.jar"));m.appendChild(h("Server-Library",k.sdk_location_url));m.appendChild(h("Versions-File-Name",k.versions_file));m.appendChild(h("JS-Version",k.js_version));if(k.document_dependencies_folder!==null){m.appendChild(h("DocumentDependenciesFolder",k.document_dependencies_folder))}if(k.series_authorization!==null){m.appendChild(h("SeriesAuthorization",k.series_authorization))}H.each(k,function(ag,ah){if(ag.indexOf("szafirsdk.")==0){m.appendChild(h(ag,ah))}});U("MOD.js : APL_loadSzafir: inserting object");document.body.appendChild(m);U("MOD.js : APL_loadSzafir: inserting done");ac=document.SZAFIRSDK_APPLET_OBJECT}function a(){U("MOD.js : APL_unloadSzafir");H("#SZAFIRSDK_APPLET_OBJECT").remove();ac=undefined;R({command:l.unload,status:W.ok,result:"UNLOADED"})}function N(m){R({command:l.startComponent,status:W.ok,result:"STARTED"})}function r(m){U("MOD.js : APL_startComponentURI");A=N;ac.startComponentURI(m)}function o(m){U("MOD.js : APL_startComponent");A=N;ac.startComponent(m)}function M(m){R({command:l.getTaskList,status:W.ok,result:m})}function v(ag){U("MOD.js : APL_getTaskListURI");A=M;var m=ac.getTaskListURI(ag)}function i(m){U("MOD.js : APL_getTaskList");A=M;var ag=ac.getTaskList(m)}function ad(m){R({command:l.doTaskList,status:W.ok,result:m})}function n(m){U("MOD.js : APL_doTaskList");A=ad;ac.doTaskList(m)}function P(m){R({command:l.doTaskListNoWindow,status:W.ok,result:m})}function E(m){U("MOD.js : APL_doTaskListNoWindow");A=P;ac.doTaskListNoWindow(m,false)}function e(m,ag){U("MOD.js : APL_doTaskListNoWindow1Pass");A=P;ac.doTaskListNoWindow(m,ag)}function Q(m,ah,ag){U("MOD.js : APL_doTaskListNoWindow2Pass");A=P;ac.doTaskListNoWindow(m,ah,ag)}function p(){U("MOD.js : APL_isCardInReader");var m=ac.isCardInReader();R({command:l.isCardInReader,status:W.ok,result:m})}function j(m){R({command:l.getSignatureInfo,status:W.ok,result:m})}function L(ah,m){U("MOD.js : APL_getSignatureInfo");A=j;do{var ag=ah.replace("\\","/");if(ag==ah){break}ah=ag}while(true);ac.getSignatureInfo(ah,m)}function t(m){R({command:l.listCertificates,status:W.ok,result:m})}function q(m){U("MOD.js : APL_listCertificates");A=t;ac.listCertificates(m)}aa.isExtInitialized=function(){var m=document.body.getAttribute("data-szafirsdk-ready");return(m==="EXT_INITIALIZED")};aa.isModeApplet=function(){return K};aa.isModeExtension=function(){return !K};aa.isWin64=function(){return s};aa.isFirefox=function(){return u};aa.isChrome=function(){return ae&&!x};aa.isOpera=function(){return x};aa.getAppLink=function(){return(s?D.windows:D.windows32)};aa.getAppLinks=function(){return D};aa.getExtLink=function(){if(aa.isFirefox()){return af.firefox_ext}else{if(aa.isChrome()){return af.chrome_ext}else{if(aa.isOpera()){return af.opera_ext}else{return"error"}}}};aa.config=function(m){H.extend(k,m);if(!k.sdk_location_url.match(/\/$/)){k.sdk_location_url+="/"}if(!k.webmodule_location_url.match(/\/$/)){k.webmodule_location_url+="/"}B()};aa.loadSzafir=function(m,ag){if(O(l.load,m,ag)){if(K){y()}else{var ai=function(){U("MOD.js : OK -> Chrome Extension Present");S({command:l.load,config:k})};var ah=function(){var ak={link:aa.getExtLink()};G(X.notInstalled,ak)};var aj=function(ao,al,an){var am=100;var ak=0;function ap(){if(aa.isExtInitialized()){al()}else{if(ak>=ao){an()}else{ak+=am;U("MOD.js : OK -> Waiting for extension: "+ak);setTimeout(ap,am)}}}ap()};aj(2000,ai,ah)}}};aa.unloadSzafir=function(m,ag){if(O(l.unload,m,ag)){if(K){a()}else{S({command:l.unload})}}};aa.startComponent=function(ah,m,ag){if(O(l.startComponent,m,ag)){if(K){o(ah)}else{S({command:l.startComponent,settings_xml:ah})}}};aa.startComponentURI=function(ah,m,ag){if(O(l.startComponentURI,m,ag)){H.ajax({url:ah,dataType:"text",success:function(ai){if(K){o(ai)}else{S({command:l.startComponent,settings_xml:ai})}},error:function(ai,ak,aj){d({command:l.startComponentURI,result:aj})}})}};aa.getTaskList=function(ah,m,ag){if(O(l.getTaskList,m,ag)){if(K){i(ah)}else{S({command:l.getTaskList,maketasklist_xml:ah})}}};aa.getTaskListURI=function(ah,m,ag){if(O(l.getTaskListURI,m,ag)){H.ajax({url:ah,dataType:"text",success:function(ai){if(K){i(ai)}else{S({command:l.getTaskList,maketasklist_xml:ai})}},error:function(ai,ak,aj){d({command:l.getTaskListURI,result:aj})}})}};aa.doTaskList=function(ah,m,ag){if(O(l.doTaskList,m,ag)){if(K){n(ah)}else{S({command:l.doTaskList,tasklist_xml:ah})}}};aa.doTaskListURI=function(ah,m,ag){if(O(l.doTaskListURI,m,ag)){H.ajax({url:ah,dataType:"text",success:function(ai){if(K){n(ai)}else{S({command:l.doTaskList,tasklist_xml:ai})}},error:function(ai,ak,aj){d({command:l.doTaskListURI,result:aj})}})}};aa.doTaskListNoWindow=function(ah,m,ag){if(O(l.doTaskListNoWindow,m,ag)){if(K){E(ah)}else{S({command:l.doTaskListNoWindow,tasklist_xml:ah})}}};aa.doTaskListNoWindowURI=function(ah,m,ag){if(O(l.doTaskListNoWindowURI,m,ag)){H.ajax({url:ah,dataType:"text",success:function(ai){if(K){E(ai)}else{S({command:l.doTaskListNoWindow,tasklist_xml:ai})}},error:function(ai,ak,aj){d({command:l.doTaskListNoWindowURI,result:aj})}})}};aa.doTaskListNoWindow1Pass=function(ai,ah,m,ag){if(O(l.doTaskListNoWindow1Pass,m,ag)){if(K){e(ai,ah)}else{S({command:l.doTaskListNoWindow,tasklist_xml:ai,sig_pass:ah})}}};aa.doTaskListNoWindow1PassURI=function(ai,ah,m,ag){if(O(l.doTaskListNoWindow1PassURI,m,ag)){H.ajax({url:ai,dataType:"text",success:function(aj){if(K){e(aj,ah)}else{S({command:l.doTaskListNoWindow,tasklist_xml:aj,sig_pass:ah})}},error:function(aj,al,ak){d({command:l.doTaskListNoWindow1PassURI,result:ak})}})}};aa.doTaskListNoWindow2Pass=function(aj,ai,ah,m,ag){if(O(l.doTaskListNoWindow2Pass,m,ag)){if(K){Q(aj,ai,ah)}else{S({command:l.doTaskListNoWindow,tasklist_xml:aj,sig_pass:ai,tss_pass:ah})}}};aa.doTaskListNoWindow2PassURI=function(aj,ai,ah,m,ag){if(O(l.doTaskListNoWindow2PassURI,m,ag)){H.ajax({url:aj,dataType:"text",success:function(ak){if(K){Q(ak,ai,ah)}else{S({command:l.doTaskListNoWindow,tasklist_xml:ak,sig_pass:ai,tss_pass:ah})}},error:function(ak,am,al){d({command:l.doTaskListNoWindow2PassURI,result:al})}})}};aa.isCardInReader=function(m,ag){if(O(l.isCardInReader,m,ag)){if(K){p()}else{S({command:l.isCardInReader})}}};aa.getSignatureInfo=function(ah,m,ag){if(O(l.getSignatureInfo,m,ag)){if(K){L(ah,false)}else{S({command:l.getSignatureInfo,signature_uri:ah,export_data:false})}}};aa.getSignatureInfoExportData=function(ah,m,ag){if(O(l.getSignatureInfo,m,ag)){if(K){L(ah,true)}else{S({command:l.getSignatureInfo,signature_uri:ah,export_data:true})}}};aa.listCertificates=function(ah,m,ag){if(O(l.listCertificates,m,ag)){if(K){q(ah)}else{S({command:l.listCertificates,type:ah})}}};aa.test=function(ah,m,ag){if(ae){O(l.test,m,ag);S({command:l.test,data:ah})}};aa.testProcessCommand=function(ai,m,ag){var ah="listCertificates2";if(ae){O(ah,m,ag);S({command:ah,type:ai})}};aa.isHostUpdateRequired=function(){return g};aa.SzafirAppletResultPartHandler=function(m){V+=(m||"")};aa.SzafirAppletResultHandler=function(m){if(A instanceof Function){if((m||"").length==0&&V.length>0){m=V}V="";A(m)}else{U("APL:ERROR -> _fnSzafirAppletResultHandler not set")}A=undefined};aa.SzafirAppletErrorHandler=function(m){if(ab instanceof Function){ab(m)}else{U("APL:ERROR -> _fnSzafirAppletErrorHandler not set")}};return w||aa})(SZAFIR_SDK,jQuery);