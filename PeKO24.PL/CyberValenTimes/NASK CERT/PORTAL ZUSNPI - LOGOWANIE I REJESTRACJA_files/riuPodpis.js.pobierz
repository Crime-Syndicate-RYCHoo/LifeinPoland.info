function RiuPodpis(){this.loadCallback;this.startCallback=function(){window.SZAFIR_SDK.doTaskListNoWindow(riuPodpis.podpisTaskList,riuPodpis.szafirDoTaskListHandler,riuPodpis.szafirDoTaskListHandler)};this.signCallback;this.fnSzafirAppletResultHandler;this.fnSzafirAppletErrorHandler;this.szafirLoadedHanlder=function(i){riuPodpis.loadCallback()};this.szafirStartedHanlder=function(i){riuPodpis.startCallback()};this.szafirDoTaskListHandler=function(i){riuPodpis.signCallback(i)};this.defaultError=function(i){alert("Wystąpił błąd podczas ładowania komponentu kir ("+i+")")};this.sprawdzPodpis=function(j){var i=false;if(j){$.ajax("riu/riuSprawdzPodpis.npi",{data:{xmlData:j},async:false,type:"POST",success:function(k){riu.komunikatBledu=k.blad;i=k.wartosc}})}return i};this.pobierzOswiadczenie=function(i){if(riuPodpis.xmlData==null){$.ajax(i,{async:false,type:"POST",success:function(j){riuPodpis.xmlData=j.tresc}})}};this.wyswietlOswiadczenie=function(i){this.pobierzOswiadczenie(i);this.wyswietlOswiadczenieDoPodpisania(riuPodpis.xmlData)};this.wyswietlOswiadczenieDoPodpisania=function(i){alert({content:i,dialogHeight:"180px",dialogWidth:"780px"})};this.podpisSettings=null;this.podpisTaskList=null;this.podpisSettingUrl=null;this.pobierzXML=function(k,j,i){$.ajax("riu/riuXMLPodpis.npi",{data:{xmlData:k,issuer:j,serial:i},async:false,type:"POST",headers:{"X-Session-Verify":a()},success:function(l){riuPodpis.podpisSettings=l.ustawienia;riuPodpis.podpisTaskList=l.zadania;riuPodpis.podpisSettingUrl=l.settingsUrl}})};this.dodajDokumentEPUAP=function(i,j,k){var l=function(){riuPodpis.dodajDokumentEPUACallback(i,j)};checkEPUAPInfoAndShowMessageAsync(null,l,l,k)};this.dodajDokumentEPUACallback=function(i,k){var j={url:i,handleAs:"json",sync:true,load:function(l){url=l.url;if(url!=null){document.location.href=url}else{riu.komunikatBledu=l.blad;menuSelect(k)}},error:function(l,m){l(l)}};dojo.xhrPost(j)};this.zalogujSSOEPUAP=function(i){var j={url:i,handleAs:"json",sync:true,load:function(k){window.location.href=k.url}};dojo.xhrPost(j)};this.dodajDokumentEPUAPLogowanie=function(i,j){var k=function(){riuPodpis.dodajDokumentEPUAPLogowanieCallback(i,j)};checkEPUAPInfoAndShowMessageAsync(null,k,k)};this.dodajDokumentEPUAPLogowanieCallback=function(i,l){var j={url:i,handleAs:"json",sync:true,load:function(n){url=n.url;if(url!=null){document.location.href=url}else{riu.komunikatBledu=n.blad;menuSelect(l)}},error:function(n,o){n(n)}};var m=new zusnpi.layout.splash.Splashscreen({parentId:dijit.byId("logowanieMainContainerId").containerNode.id,text:"Proszę czekać",additionalText:"Trwa przekierowanie na ePUAP...",timeoutMillis:1800000});m.show();var k=new dojox.timing.Timer(1500);k.onTick=function(){k.stop();dojo.xhrPost(j)};k.start()};this.weryfikujDokumentEPUAP=function(j){var i={url:"riu/riuWeryfikujDokumentEPUAP.npi",handleAs:"json",sync:true,load:function(k){zweryfikowany=k.zweryfikowany;if(!zweryfikowany){riu.komunikatBledu=k.blad;menuSelect(j)}},error:function(k,l){k(k)}};dojo.xhrPost(i);return zweryfikowany};var f=null;var e=null;var h=false;this.podpiszDokument=function(i,k,j,l){if(riuPodpis.xmlData==null){riuPodpis.pobierzOswiadczenie(i)}riuPodpis.pobierzXML(riuPodpis.xmlData,k,j);riuPodpis.signCallback=function(m){riuPodpis.xmlResult=m;l(riuPodpis.sprawdzPodpis(m))};window.SZAFIR_SDK.startComponentURI(riuPodpis.podpisSettingUrl,riuPodpis.szafirStartedHanlder,riuPodpis.defaultError)};this.timer=null;this.appletSettingsUrl=null;this.obsluzWyjatekWywolaniaAppletu=function(i){error("Wystąpił błąd podczas podpisywania dokumentu. Upewnij się, że twoja przeglądarka ma zainstalowaną i włączoną obsługę najnowszej wtyczki Javy.");console.error(i)};this.czyJavaObslugiwana=function(){var i=navigator.javaEnabled();if(!i){alert(riuPodpis.brakJavyKomunikat)}return i};this.czyUzywamyWtyczki=function(){if($("#szafirsdk-mode").val()=="SZAFIR_SDK_EXT"){return true}return false};this.brakJavyKomunikat="Twoja przeglądarka nie obsługuje Javy.\nUpewnij się, że na Twoim komputerze zainstalowana jest Java oraz jej obsługa jest włączona w przeglądarce.";this.dodajApplet=function(){riuPodpis.blokujPrzycisk(riuJezyk.zwrocTekst("Proszę czekać ...","Зачекайте будь ласка ..."));riuPodpis.loadCallback=function(){riuPodpis.zwolnijPrzycisk()};if(window.SZAFIR_SDK.isModeExtension()){setTimeout(function(){window.SZAFIR_SDK.loadSzafir(riuPodpis.szafirLoadedHanlder,riuPodpis.defaultError)},200)}else{window.SZAFIR_SDK.loadSzafir(riuPodpis.szafirLoadedHanlder,riuPodpis.defaultError)}};var d=null;var c=null;var g=null;var b=function(){riuPodpis.logowanieButton=$("#logowanieButton");riuPodpis.logowanieButtonLabel=$("#logowanieButtonLabel");riuPodpis.logowanieButtonDefaultLabel=riuPodpis.logowanieButtonLabel.html()};this.blokujPrzycisk=function(i){if(riuPodpis.logowanieButton==null){b()}riuPodpis.logowanieButton.prop("disabled",true);riuPodpis.logowanieButtonLabel.html(i)};this.zwolnijPrzycisk=function(){if(riuPodpis.logowanieButton==null){b()}riuPodpis.logowanieButton.prop("disabled",false);riuPodpis.logowanieButtonLabel.html(riuPodpis.logowanieButtonDefaultLabel)};var a=function(){return typeof getCsrfTokenFromMeta=="function"?getCsrfTokenFromMeta():undefined}}var riuPodpis=new RiuPodpis();