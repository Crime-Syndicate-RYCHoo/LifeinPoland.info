define("common/basePlugin",["require","adapter/dom","adapter/enumerable","adapter/jsClass","pubsub","common/utils"],function(f){var g=f("adapter/dom");var b=f("adapter/enumerable");var d=f("adapter/jsClass");var c=f("pubsub");var a=f("common/utils");var e=d.Class({constructor:function(m,i,l,h){this.modId=this.modId||m;this.name=this.name||i;this.subname=this.subname||l;this.options=this.options||h||{};this.pluginId=this.pluginId||(m+"--"+i.replace(".","_")+(l?"--"+l:"")),this.eventNamespace=this.eventNamespace||(this.options.eventNs||m);this.config=this.config||{actions:{test:this.checkTestAction}};this.actionHandlers=this.actionHandlers||{};this.extensions=this.extensions||{};this.actionEventToken=this.subscribe(ns.events.pluginActionCall,this.onPluginAction.bind(this));var j=this;if(this.options.extend&&this.options.extend.length>0){var k=new Array();b.each(this.options.extend,function(o,n){k.push(config.pluginsPath+o)});f(k,function(){j.log("extensions loaded",arguments);b.each(arguments,function(o,n){j.extensions[o.name]=o});j.onExtensionInit()})}this.publish(ns.events.pluginInit,{})},setInitError:function(l,i,k,h,j){this.modId=this.modId||l;this.name=this.name||i;this.subname=this.subname||k;this.options=this.options||h;this.pluginId=this.pluginId||(l+"--"+i.replace(".","_")+(k?"--"+k:"")),this.eventNamespace=this.eventNamespace||(h.eventNs||l);this.publish(ns.events.pluginInitError,{msg:j})},onExtensionInit:function(){},stop:function(){var h=this;c.unsubscribe(this.actionEventToken);this.publish(ns.events.pluginStop,{})},askForAction:function(m,l,k){var h=this;var j=this.subscribe(ns.events.pluginAnswer,h.onAskForActionAnswer.bind(h));this.actionHandlers[j]=k.bind(h);var i={action:m,data:l,actionToken:j};this.publish(ns.events.pluginAsk,i)},onAskForActionAnswer:function(h,i){var j=i.actionToken;if(this.actionHandlers[j]){this.actionHandlers[j](h,i);c.unsubscribe(j)}else{this.log("@BasePlugin: actionToken is not actual (probably plugin was unloaded)")}},publish:function(h,i){if(!i){i={}}i.eventSource=this.pluginId;i.eventSourceId=this.modId;return c.publish(this.getEventPrefix()+h,i)},subscribe:function(h,i){return c.subscribe(this.getEventPrefix()+h,i)},unsubscribe:function(h){return c.unsubscribe(h)},getEventPrefix:function(){var h=this.name+((this.subname)?"-"+this.subname:"");return this.eventNamespace+"."+h+"."},isInterested:function(h){return b.has(this.config.actions,h)},onPluginAction:function(h,j){if(this.isInterested(j.action)){var i=b.clone(j);i.status=this.config.actions[j.action].bind(this)(h,j.data);this.publish(ns.events.pluginActionAnswer,i)}},checkTestAction:function(){return 1},log:function(){var h=Array.prototype.slice.call(arguments);h.unshift("@"+this.name+": ");a.dev.log.bind(this)(h)},info:function(){var h=Array.prototype.slice.call(arguments);h.unshift("@"+this.name+": ");a.dev.info.bind(this)(h)},warn:function(){var h=Array.prototype.slice.call(arguments);h.unshift("@"+this.name+": ");a.dev.warn.bind(this)(h)},error:function(){var h=Array.prototype.slice.call(arguments);h.unshift("@"+this.name+": ");a.dev.error.bind(this)(h)}});return e});